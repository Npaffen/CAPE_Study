}else if(IV == T && stage == 2){ #formula to obtain residuals for distribution of luck u
rq1 = LASSO.fit(Y, controls , tau = c(0.1, 0.3, 0.5, 0.7, 0.9), intercept = T, lambda = 1, coef.cutoff=1e-08)
X_Lasso <-  controls %>% .[,rq1[2:length(rq1)]!=0] %>% as_tibble() %>% names
if('ability' %in% X_lasso){X_Lasso <- gsub(pattern = 'ability', replacement = '') } #make sure that specific variables do not appear in X_Lasso
formula <- as.formula(str_c('log_hourly_wages ~ 1 + ability + ability:edu_years ',
str_c(X_Lasso, collapse = '+'), sep = '+') %>% gsub(pattern = '\\+\\+', replacement = '+'))
}else if(IV == T && stage == 3){ #formula to get effect of key parameter
rq1 = LASSO.fit(Y, IV_dataset , tau = c(0.1, 0.3, 0.5, 0.7, 0.9), intercept = T, lambda = 1, coef.cutoff=1e-08)
X_Lasso <-  controls %>% .[,rq1[2:length(rq1)]!=0] %>% as_tibble() %>% names
if('key_param|ability_cdf|luck_cdf' %in% X_lasso){X_Lasso <- gsub(pattern = 'key_param|ability_cdf|luck_cdf', replacement = '') }
formula <- as.formula(str_c('log_hourly_earnings ~ 1 + ability:key_para + ability_cdf + luck_cdf  ',
str_c(X_Lasso, collapse = '+'), sep = '+') %>% gsub(pattern = '\\+\\+', replacement = '+'))
}
return(formula)
}
f_lasso_cov(controls = controls,IV = IV, stage = stage , Y = Y)
# for quantile effects when education is treated as exogenous
formula <- f_lasso_cov(controls = controls,IV = IV, stage = stage , Y = Y)
fit <- rq(formula, tau = tau, method = 'sfn', data = dataset)
source(str_c(here::here(), '/src/functions.R'))
#quantile effects when education is treated as exogenpus
f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#quantile effects when education is treated as exogenpus
qe_exo_men <- f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 0, IV = F) #inputs dataset, gender, stage, tau
qe_exo_female <- f_rq_results(dataset = dataset, tau = tau, gender = 2, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qe_exo_men <- f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
#quantile effects when education is treated as exogenpus
qe_exo_men <- f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 0, IV = F) #inputs dataset, gender, stage, tau
qe_exo_female <- f_rq_results(dataset = dataset, tau = tau, gender = 2, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_men <- f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
qr_fs_female <- f_rq_results(dataset = dataset, tau = tau, gender = 2, stage = 1, IV = T) #inputs dataset, gender, stage, tau
qr_fs_men$fitted.values
ability <- dataset$edu_years - qr_fs_men$fitted.values
ability
dataset_male <- dataset %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_men$fitted.values)
length(qr_fs_men$residuals)
dataset_male <- dataset %>% filter(gender == 1)
dataset_female <- dataset %>% filter(gender == 0)
dataset_male <- dataset %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_men$fitted.values)
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_men <- f_rq_results(dataset = dataset, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_men <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_men$fitted.values)
fit <- rq(formula, tau = tau, method = 'sfn', data = dataset_male)
# for quantile effects when education is treated as exogenous
formula <- f_lasso_cov(controls = controls,IV = IV, stage = stage , Y = Y)
fit <- rq(formula, tau = tau, method = 'sfn', data = dataset_male)
fit
length(fit$residuals)
#quantile effects when education is treated as exogenpus
qr_exo_male <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_men <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_men$fitted.values)
dataset_male <- dataset %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_men$residuals)
dataset_male <- dataset_male %>% filter(gender == 1) %>% mutate(ability = dataset$edu_years - qr_fs_male$residuals)
dataset_male <- dataset_male %>% filter(gender == 1) %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male %>% filter(gender == 1) %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
qr_fs_female <- f_rq_results(dataset = dataset_female, tau = tau, gender = 2, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_female %>% mutate(ability = dataset_female$edu_years - qr_fs_female$residuals)
View(dataset_male)
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
dataset_male$ability
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
dataset_male$ability
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = tau, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
dataset_male$ability
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = 0.1, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
dataset_male$ability
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = 0.1, gender = 1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
dataset_male$ability
qr_fs_female <- f_rq_results(dataset = dataset_female, tau = tau, gender = 2, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_female <- dataset_female %>% mutate(ability = dataset_female$edu_years - qr_fs_female$residuals)
#quantile effects when education is treated as exogenpus
qr_exo_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 0, IV = F) #inputs dataset, gender, stage, tau
qr_exo_female <- f_rq_results(dataset = dataset_female, tau = tau, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 1, IV = T) #inputs dataset, gender, stage, tau
dataset_male <- dataset_male  %>% mutate(ability = dataset_male$edu_years - qr_fs_male$residuals)
ability_male = dataset_male$edu_years - qr_fs_male$residuals
qr_fs_female <- f_rq_results(dataset = dataset_female, tau = tau, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female <- dataset_female$edu_years - qr_fs_female$residuals
dataset_female <- dataset_female %>% mutate(ability = ability_female)
qr_luck_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 2, IV = T) #inputs dataset, gender, stage, tau
luck_male = dataset_male$edu_years - qr_luck_male$residuals
dataset_male <- dataset_male  %>% mutate(luck = luck_male)
qr_luck_female <- f_rq_results(dataset = dataset_female, tau = tau, stage = 2, IV = T) #inputs dataset, gender, stage, tau
luck_female <- dataset_female$edu_years - qr_luck_female$residuals
dataset_female <- dataset_female %>% mutate(luck = luck_female)
qr_luck_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 2, IV = T) #inputs dataset, gender, stage, tau
luck_male =  qr_luck_male$residuals
dataset_male <- dataset_male  %>% mutate(luck = luck_male)
qr_luck_female <- f_rq_results(dataset = dataset_female, tau = tau, stage = 2, IV = T) #inputs dataset, gender, stage, tau
luck_female <-  qr_luck_female$residuals
dataset_female <- dataset_female %>% mutate(luck = luck_female)
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male = dataset_male$edu_years - qr_fs_male$residuals
ability_male
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a
qr_fs_male <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male = dataset_male$edu_years - qr_fs_male$residuals
ability_male
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(ability_t01 = ability_male)
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(ability_t03 = ability_male)
qr_fs_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male_t05 = dataset_male$edu_years - qr_fs_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(ability_t05 = ability_male)
qr_fs_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male_t07 = dataset_male$edu_years - qr_fs_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(ability_t07 = ability_male)
qr_fs_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_male_t09 = dataset_male$edu_years - qr_fs_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(ability_t09 = ability_male)
##############################female##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female)
qr_fs_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t03 = dataset_female$edu_years - qr_fs_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(ability_t03 = ability_female)
qr_fs_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t05 = dataset_female$edu_years - qr_fs_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(ability_t05 = ability_female)
qr_fs_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t07 = dataset_female$edu_years - qr_fs_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(ability_t07 = ability_female)
qr_fs_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t09 = dataset_female$edu_years - qr_fs_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(ability_t09 = ability_female)
##############################female##############################
qr_fs_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #inputs dataset, gender, stage, tau
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female)
##############################male##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(ability_t01 = ability_male)
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(ability_t03 = ability_male)
qr_fs_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_male_t05 = dataset_male$edu_years - qr_fs_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(ability_t05 = ability_male)
qr_fs_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_male_t07 = dataset_male$edu_years - qr_fs_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(ability_t07 = ability_male)
qr_fs_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_male_t09 = dataset_male$edu_years - qr_fs_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(ability_t09 = ability_male)
##############################female##############################
qr_fs_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female)
qr_fs_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_female_t03 = dataset_female$edu_years - qr_fs_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(ability_t03 = ability_female)
qr_fs_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_female_t05 = dataset_female$edu_years - qr_fs_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(ability_t05 = ability_female)
qr_fs_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_female_t07 = dataset_female$edu_years - qr_fs_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(ability_t07 = ability_female)
qr_fs_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_female_t09 = dataset_female$edu_years - qr_fs_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(ability_t09 = ability_female)
#obtain residuals for distribution of luck u
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
luck_male_t01 = dataset_male$edu_years - qr_luck_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(luck_t01 = luck_male)
qr_luck_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
luck_male_t03 = dataset_male$edu_years - qr_luck_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(luck_t03 = luck_male)
qr_luck_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
luck_male_t05 = dataset_male$edu_years - qr_luck_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(luck_t05 = luck_male)
qr_luck_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
luck_male_t07 = dataset_male$edu_years - qr_luck_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(luck_t07 = luck_male)
qr_luck_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
luck_male_t09 = dataset_male$edu_years - qr_luck_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(luck_t09 = luck_male)
##############################female##############################
qr_luck_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
luck_female_t01 = dataset_female$edu_years - qr_luck_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(luck_t01 = luck_female)
qr_luck_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
luck_female_t03 = dataset_female$edu_years - qr_luck_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(luck_t03 = luck_female)
qr_luck_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
luck_female_t05 = dataset_female$edu_years - qr_luck_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(luck_t05 = luck_female)
qr_luck_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
luck_female_t07 = dataset_female$edu_years - qr_luck_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(luck_t07 = luck_female)
qr_luck_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
luck_female_t09 = dataset_female$edu_years - qr_luck_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(luck_t09 = luck_female)
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$residuals
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
##############################male##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(ability_t01 = ability_male)
CDF_ability_male_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t01))
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(ability_t03 = ability_male)
CDF_ability_03 <- pnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t03))
qr_fs_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_male_t05 = dataset_male$edu_years - qr_fs_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(ability_t05 = ability_male)
CDF_ability_05 <- pnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t05))
qr_fs_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_male_t07 = dataset_male$edu_years - qr_fs_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(ability_t07 = ability_male)
CDF_ability_07 <- pnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t07))
qr_fs_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_male_t09 = dataset_male$edu_years - qr_fs_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(ability_t09 = ability_male)
CDF_ability_09 <- pnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t09))
##############################female##############################
qr_fs_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female)
CDF_ability_female_01 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(ability_female_t01))
qr_fs_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_female_t03 = dataset_female$edu_years - qr_fs_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(ability_t03 = ability_female)
CDF_ability_03 <- pnorm(n = nrow(dataset_female), mean = , sd = sd(ability_female_t03))
qr_fs_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_female_t05 = dataset_female$edu_years - qr_fs_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(ability_t05 = ability_female)
CDF_ability_05 <- pnorm(n = nrow(dataset_female), mean = , sd = sd(ability_female_t05))
qr_fs_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_female_t07 = dataset_female$edu_years - qr_fs_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(ability_t07 = ability_female)
CDF_ability_07 <- pnorm(n = nrow(dataset_female), mean = , sd = sd(ability_female_t07))
qr_fs_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_female_t09 = dataset_female$edu_years - qr_fs_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(ability_t09 = ability_female)
CDF_ability_09 <- pnorm(n = nrow(dataset_female), mean = , sd = sd(ability_female_t09))
#obtain residuals for distribution of luck u
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
luck_male_t01 = dataset_male$edu_years - qr_luck_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(luck_t01 = luck_male)
CDF_ability_01 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(luck_male_t01))
qr_luck_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
luck_male_t03 = dataset_male$edu_years - qr_luck_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(luck_t03 = luck_male)
CDF_luck_03 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(luck_male_t03))
qr_luck_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
luck_male_t05 = dataset_male$edu_years - qr_luck_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(luck_t05 = luck_male)
CDF_luck_05 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(luck_male_t05))
qr_luck_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
luck_male_t07 = dataset_male$edu_years - qr_luck_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(luck_t07 = luck_male)
CDF_luck_07 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(luck_male_t07))
qr_luck_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
luck_male_t09 = dataset_male$edu_years - qr_luck_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(luck_t09 = luck_male)
CDF_luck_09 <- rnorm(n = nrow(dataset_male), mean = , sd = sd(luck_male_t09))
##############################fefemale##############################
qr_luck_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
luck_female_t01 = dataset_female$edu_years - qr_luck_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(luck_t01 = luck_female)
CDF_ability_01 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(luck_female_t01))
qr_luck_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
luck_female_t03 = dataset_female$edu_years - qr_luck_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(luck_t03 = luck_female)
CDF_luck_03 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(luck_female_t03))
qr_luck_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
luck_female_t05 = dataset_female$edu_years - qr_luck_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(luck_t05 = luck_female)
CDF_luck_05 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(luck_female_t05))
qr_luck_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
luck_female_t07 = dataset_female$edu_years - qr_luck_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(luck_t07 = luck_female)
CDF_luck_07 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(luck_female_t07))
qr_luck_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
luck_female_t09 = dataset_female$edu_years - qr_luck_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(luck_t09 = luck_female)
CDF_luck_09 <- rnorm(n = nrow(dataset_female), mean = , sd = sd(luck_female_t09))
# get effect of key parameter
CDF_ability_03 <- pnorm(n = nrow(dataset_male), mean = , sd = sd(ability_male_t03))
dataset_male$edu_years - qr_fs_male_t01$fitted.values
CDF_ability_male_01 <- qnorm( 0.1, sd = sd(ability_male_t01))
CDF_ability_male_01
CDF_ability_male_01 <- qnorm( 0.1, sd = sd(ability_male_t01))
CDF_ability_male_01
CDF_ability_male_01 <- qnorm( sd = sd(ability_male_t01))
ability_female_t01^-1
ability_female_t01
CDF_ability_male_01 <- rnorm(n = nrow(abilit_male_t01), sd = sd(ability_male_t01))^-1
CDF_ability_male_01 <- rnorm(n = nrow(ability_male_t01), sd = sd(ability_male_t01))^-1
CDF_ability_male_01 <- (rnorm(n = nrow(ability_male_t01), sd = sd(ability_male_t01)))^-1
CDF_ability_male_01 <- (rnorm(n = nrow(ability_male_t01), sd = sd(ability_male_t01)))
CDF_ability_male_01 <- rnorm(n = nrow(ability_male_t01), sd = sd(ability_male_t01))
nrow(ability_male_t01)
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$fitted.values
CDF_ability_male_01 <- rnorm(n = nrow(ability_male_t01), sd = sd(ability_male_t01))
CDF_ability_male_01 <- rnorm(n = length(ability_male_t01), sd = sd(ability_male_t01))
CDF_ability_male_01 <- rnorm(n = length(ability_male_t01), sd = sd(ability_male_t01))^-1
CDF_ability_male_01
##############################male##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t01 = ability_male)
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t03 = ability_male)
qr_fs_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_male_t05 = dataset_male$edu_years - qr_fs_male_t05$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t05 = ability_male)
qr_fs_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_male_t07 = dataset_male$edu_years - qr_fs_male_t07$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t07 = ability_male)
qr_fs_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_male_t09 = dataset_male$edu_years - qr_fs_male_t09$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t09 = ability_male)
##############################female##############################
qr_fs_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female)
qr_fs_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_female_t03 = dataset_female$edu_years - qr_fs_female_t03$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t03 = ability_female)
qr_fs_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_female_t05 = dataset_female$edu_years - qr_fs_female_t05$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t05 = ability_female)
qr_fs_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_female_t07 = dataset_female$edu_years - qr_fs_female_t07$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t07 = ability_female)
qr_fs_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_female_t09 = dataset_female$edu_years - qr_fs_female_t09$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t09 = ability_female)
##########################################################################################################
#obtain residuals for distribution of luck u
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 2, IV = T) #tau = 0.1
luck_male_t01 = dataset_male$edu_years - qr_luck_male_t01$residuals
dataset_male <- dataset_male  %>% mutate(luck_t01 = luck_male)
qr_luck_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 2, IV = T) #tau = 0.3
luck_male_t03 = dataset_male$edu_years - qr_luck_male_t03$residuals
dataset_male <- dataset_male  %>% mutate(luck_t03 = luck_male)
qr_luck_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 2, IV = T) #tau = 0.5
luck_male_t05 = dataset_male$edu_years - qr_luck_male_t05$residuals
dataset_male <- dataset_male  %>% mutate(luck_t05 = luck_male)
qr_luck_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 2, IV = T) #tau = 0.7
luck_male_t07 = dataset_male$edu_years - qr_luck_male_t07$residuals
dataset_male <- dataset_male  %>% mutate(luck_t07 = luck_male)
qr_luck_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 2, IV = T) #tau = 0.9
luck_male_t09 = dataset_male$edu_years - qr_luck_male_t09$residuals
dataset_male <- dataset_male  %>% mutate(luck_t09 = luck_male)
##############################fefemale##############################
qr_luck_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 2, IV = T) #tau = 0.1
luck_female_t01 = dataset_female$edu_years - qr_luck_female_t01$residuals
dataset_female <- dataset_female  %>% mutate(luck_t01 = luck_female)
qr_luck_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 2, IV = T) #tau = 0.3
luck_female_t03 = dataset_female$edu_years - qr_luck_female_t03$residuals
dataset_female <- dataset_female  %>% mutate(luck_t03 = luck_female)
qr_luck_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 2, IV = T) #tau = 0.5
luck_female_t05 = dataset_female$edu_years - qr_luck_female_t05$residuals
dataset_female <- dataset_female  %>% mutate(luck_t05 = luck_female)
qr_luck_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 2, IV = T) #tau = 0.7
luck_female_t07 = dataset_female$edu_years - qr_luck_female_t07$residuals
dataset_female <- dataset_female  %>% mutate(luck_t07 = luck_female)
qr_luck_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 2, IV = T) #tau = 0.9
luck_female_t09 = dataset_female$edu_years - qr_luck_female_t09$residuals
dataset_female <- dataset_female  %>% mutate(luck_t09 = luck_female)
# get effect of key parameter
key_para__men_abi_01_luck_01 <- matrix(ability_male_t01, luck_male_t01)
source(str_c(here::here(), '/src/functions.R'))
dataset_male <- dataset %>% filter(gender == 1)
dataset_female <- dataset %>% filter(gender == 0)
#quantile effects when education is treated as exogenpus
qr_exo_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 0, IV = F) #inputs dataset, gender, stage, tau
library(quantreg)
library(tidyverse)
library(pracma)
library(rqPen)
dataset_male <- dataset %>% filter(gender == 1)
dataset_female <- dataset %>% filter(gender == 0)
#quantile effects when education is treated as exogenpus
qr_exo_male <- f_rq_results(dataset = dataset_male, tau = tau, stage = 0, IV = F) #inputs dataset, gender, stage, tau
qr_exo_female <- f_rq_results(dataset = dataset_female, tau = tau, stage = 0, IV = F) #inputs dataset, gender, stage, tau
#first stage effect of ycomp on s, coefficients = of 2 parameter, fitted values for distribution of a needs to be done for each tau
set.seed(1337) #Seed for CDF
##############################male##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
##############################male##############################
qr_fs_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_male_t01 = dataset_male$edu_years - qr_fs_male_t01$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t01 = ability_male_t01)
qr_fs_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_male_t03 = dataset_male$edu_years - qr_fs_male_t03$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t03 = ability_male_t03)
qr_fs_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_male_t05 = dataset_male$edu_years - qr_fs_male_t05$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t05 = ability_male_t05)
qr_fs_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_male_t07 = dataset_male$edu_years - qr_fs_male_t07$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t07 = ability_male_t07)
qr_fs_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_male_t09 = dataset_male$edu_years - qr_fs_male_t09$fitted.values
dataset_male <- dataset_male  %>% mutate(ability_t09 = ability_male_t09)
##############################female##############################
qr_fs_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 1, IV = T) #tau = 0.1
ability_female_t01 = dataset_female$edu_years - qr_fs_female_t01$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t01 = ability_female_t01)
qr_fs_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 1, IV = T) #tau = 0.3
ability_female_t03 = dataset_female$edu_years - qr_fs_female_t03$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t03 = ability_female_t03)
qr_fs_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 1, IV = T) #tau = 0.5
ability_female_t05 = dataset_female$edu_years - qr_fs_female_t05$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t05 = ability_female_t05)
qr_fs_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 1, IV = T) #tau = 0.7
ability_female_t07 = dataset_female$edu_years - qr_fs_female_t07$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t07 = ability_female_t07)
qr_fs_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 1, IV = T) #tau = 0.9
ability_female_t09 = dataset_female$edu_years - qr_fs_female_t09$fitted.values
dataset_female <- dataset_female  %>% mutate(ability_t09 = ability_female_t09)
##########################################################################################################
#obtain fitted values for distribution of luck u and beta
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 2, IV = T, ability_g_tau = 'ability_t01') #tau = 0.1
luck_male_t01 = dataset_male$log_hourly_earnings - qr_luck_male_t01$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t01 = luck_male_t01) %>% mutate(beta_01 = qr_luck_male_t01$coefficients[2])
qr_luck_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 2, IV = T,ability_g_tau = 'ability_t03') #tau = 0.3
luck_male_t03 = dataset_male$log_hourly_earnings - qr_luck_male_t03$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t03 = luck_male_t03) %>% mutate(beta_03 = qr_luck_male_t03$coefficients[2])
qr_luck_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 2, IV = T, ability_g_tau = 'ability_t05') #tau = 0.5
luck_male_t05 = dataset_male$log_hourly_earnings - qr_luck_male_t05$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t05 = luck_male_t05) %>% mutate(beta_05 = qr_luck_male_t05$coefficients[2])
qr_luck_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 2, IV = T, ability_g_tau = 'ability_t07') #tau = 0.7
luck_male_t07 = dataset_male$log_hourly_earnings - qr_luck_male_t07$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t07 = luck_male_t07) %>% mutate(beta_07 = qr_luck_male_t07$coefficients[2])
qr_luck_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 2, IV = T, ability_g_tau = 'ability_t09') #tau = 0.9
luck_male_t09 = dataset_male$log_hourly_earnings - qr_luck_male_t09$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t09 = luck_male_t09) %>% mutate(beta_09 = qr_luck_male_t09$coefficients[2])
source(str_c(here::here(), '/src/functions.R'))
##########################################################################################################
#obtain fitted values for distribution of luck u and beta
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 2, IV = T, ability_g_tau = 'ability_t01') #tau = 0.1
##########################################################################################################
#obtain fitted values for distribution of luck u and beta
qr_luck_male_t01 <- f_rq_results(dataset = dataset_male, tau = 0.1, stage = 2, IV = T, ability_g_tau = 'ability_t01') #tau = 0.1
luck_male_t01 = dataset_male$log_hourly_earnings - qr_luck_male_t01$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t01 = luck_male_t01) %>% mutate(beta_01 = qr_luck_male_t01$coefficients[2])
qr_luck_male_t03 <- f_rq_results(dataset = dataset_male, tau = 0.3, stage = 2, IV = T,ability_g_tau = 'ability_t03') #tau = 0.3
luck_male_t03 = dataset_male$log_hourly_earnings - qr_luck_male_t03$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t03 = luck_male_t03) %>% mutate(beta_03 = qr_luck_male_t03$coefficients[2])
qr_luck_male_t05 <- f_rq_results(dataset = dataset_male, tau = 0.5, stage = 2, IV = T, ability_g_tau = 'ability_t05') #tau = 0.5
luck_male_t05 = dataset_male$log_hourly_earnings - qr_luck_male_t05$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t05 = luck_male_t05) %>% mutate(beta_05 = qr_luck_male_t05$coefficients[2])
qr_luck_male_t07 <- f_rq_results(dataset = dataset_male, tau = 0.7, stage = 2, IV = T, ability_g_tau = 'ability_t07') #tau = 0.7
luck_male_t07 = dataset_male$log_hourly_earnings - qr_luck_male_t07$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t07 = luck_male_t07) %>% mutate(beta_07 = qr_luck_male_t07$coefficients[2])
qr_luck_male_t09 <- f_rq_results(dataset = dataset_male, tau = 0.9, stage = 2, IV = T, ability_g_tau = 'ability_t09') #tau = 0.9
luck_male_t09 = dataset_male$log_hourly_earnings - qr_luck_male_t09$fitted.values
dataset_male <- dataset_male  %>% mutate(luck_t09 = luck_male_t09) %>% mutate(beta_09 = qr_luck_male_t09$coefficients[2])
##############################female##############################
qr_luck_female_t01 <- f_rq_results(dataset = dataset_female, tau = 0.1, stage = 2, IV = T, ability_g_tau = 'ability_t01') #tau = 0.1
luck_female_t01 = dataset_female$log_hourly_earnings - qr_luck_female_t01$fitted.values
dataset_female <- dataset_female  %>% mutate(luck_t01 = luck_female_t01) %>% mutate(beta_01 = qr_luck_female_t01$coefficients[2])
qr_luck_female_t03 <- f_rq_results(dataset = dataset_female, tau = 0.3, stage = 2, IV = T,ability_g_tau = 'ability_t03') #tau = 0.3
luck_female_t03 = dataset_female$log_hourly_earnings - qr_luck_female_t03$fitted.values
dataset_female <- dataset_female  %>% mutate(luck_t03 = luck_female_t03) %>% mutate(beta_03 = qr_luck_female_t03$coefficients[2])
qr_luck_female_t05 <- f_rq_results(dataset = dataset_female, tau = 0.5, stage = 2, IV = T, ability_g_tau = 'ability_t05') #tau = 0.5
luck_female_t05 = dataset_female$log_hourly_earnings - qr_luck_female_t05$fitted.values
dataset_female <- dataset_female  %>% mutate(luck_t05 = luck_female_t05) %>% mutate(beta_05 = qr_luck_female_t05$coefficients[2])
qr_luck_female_t07 <- f_rq_results(dataset = dataset_female, tau = 0.7, stage = 2, IV = T, ability_g_tau = 'ability_t07') #tau = 0.7
luck_female_t07 = dataset_female$log_hourly_earnings - qr_luck_female_t07$fitted.values
dataset_female <- dataset_female  %>% mutate(luck_t07 = luck_female_t07) %>% mutate(beta_07 = qr_luck_female_t07$coefficients[2])
qr_luck_female_t09 <- f_rq_results(dataset = dataset_female, tau = 0.9, stage = 2, IV = T, ability_g_tau = 'ability_t09') #tau = 0.9
luck_female_t09 = dataset_female$log_hourly_earnings - qr_luck_female_t09$fitted.values
dataset_female <- dataset_female  %>% mutate(luck_t09 = luck_female_t09) %>% mutate(beta_09 = qr_luck_female_t09$coefficients[2])
